<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>How to use Emscripten with CMake on Windows</title>
	
	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu|Lora">
	<link rel="stylesheet" href="/css/style.css">
	
</head>
<body>
	<header class="wrapper">
    <nav>
        <a href="https://badlydrawnrod.github.io">Home</a>
        <ul>
			
            
            <li><a href="/page/about/">About</a></li>
            
            <li><a href="/posts/">All posts</a></li>
            
        </ul>
    </nav>
    
</header>
	
<main class="wrapper">
    <article>
        <p></p>
        
        <div class="date">19 May, 2020</div>
        
        <div>
            <h1 id="problem">Problem</h1>
<p>You&rsquo;ve installed <strong>Emscripten</strong> on Windows, but you can&rsquo;t get it to work with <strong>CMake</strong>.</p>
<h1 id="solution">Solution</h1>
<h2 id="install-cmake">Install CMake</h2>
<p>It may seem obvious, but first you should install <strong>CMake</strong> and make sure it&rsquo;s on your path.</p>
<p>Here&rsquo;s how to install <strong>CMake</strong> with the <a href="https://scoop.sh"><strong>scoop</strong></a> package manager.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; scoop install cmake
</code></pre></div><p>Similarly, here&rsquo;s how to install <strong>CMake</strong> with the <a href="https://chocolatey.org"><strong>chocolatey</strong></a> package manager.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; choco install -y cmake --installargs &#39;ADD_CMAKE_TO_PATH=User&#39;
</code></pre></div><p>The <code>--installargs 'ADD_CMAKE_TO_PATH=User</code> parameter tells <strong>chocolatey</strong> to add the <strong>CMake</strong> binaries such as <code>cmake</code> and <code>cmake-gui</code> to your path.</p>
<p>If you don&rsquo;t have <strong>chocolatey</strong> or <strong>scoop</strong>, or don&rsquo;t want to use them, then there are other options such as downloading and installing <a href="https://cmake.org/install/">CMake binaries</a>.</p>
<h2 id="set-your-emscripten-environment">Set your Emscripten environment</h2>
<p>Run <code>emsdk_env.bat</code> from the <strong>Emscripten SDK</strong> to set the environment.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; D:\Tools\emsdk\emsdk_env.bat
Adding directories to PATH:
PATH += D:\Tools\emsdk
PATH += D:\Tools\emsdk\upstream\emscripten
PATH += D:\Tools\emsdk\node\12.9.1_64bit\bin
PATH += D:\Tools\emsdk\java\8.152_64bit\bin

Setting environment variables:
EMSDK = D:/Tools/emsdk
EM_CONFIG = C:\Users\Rod\.emscripten
EMSDK_NODE = D:\Tools\emsdk\node\12.9.1_64bit\bin\node.exe
EMSDK_PYTHON = D:\Tools\emsdk\python\3.7.4-pywin32_64bit\python.exe
JAVA_HOME = D:\Tools\emsdk\java\8.152_64bit
</code></pre></div><h2 id="run-cmake-via-emcmake">Run CMake via <code>emcmake</code></h2>
<p>Use <code>emcmake cmake</code> to run <strong>CMake</strong> with an environment suitable for <strong>Emscripten</strong>.</p>
<h3 id="using-ninja">Using Ninja</h3>
<p>If you want to use <a href="https://ninja-build.org"><strong>Ninja</strong></a> to build your projects, then run the following from your source directory:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; emcmake cmake . -B cmake-build-emscripten -G Ninja
</code></pre></div><p>This runs <code>cmake</code> via the <code>emcmake</code> tool which sets up the environment that <strong>CMake</strong> needs to use <strong>Emscripten</strong>. It uses <code>-G Ninja</code> to tell <strong>CMake</strong> to generate a build pipeline that uses <strong>Ninja</strong>.</p>
<p>If you don&rsquo;t have <strong>Ninja</strong> installed, then the easiest way of getting it is to use a package manager such as <strong>chocolatey</strong> or <strong>scoop</strong>.</p>
<p>Here&rsquo;s how to install <strong>Ninja</strong> with <a href="https://scoop.sh"><strong>scoop</strong></a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; scoop install ninja
</code></pre></div><p>And here&rsquo;s how to install <strong>Ninja</strong> with <a href="https://chocolatey.org"><strong>chocolatey</strong></a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; choco install ninja
</code></pre></div><h3 id="using-makefiles">Using Makefiles</h3>
<p>If you would like to use traditional makefiles to build your projects, then run the following from your source directory:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; emcmake cmake . -B cmake-build-emscripten -G &#34;CodeBlocks - MinGW Makefiles&#34;
</code></pre></div><p>This runs <code>cmake</code> via the <code>emcmake</code> tool which sets up the environment that <strong>CMake</strong> needs to use <strong>Emscripten</strong>. It uses <code>-G &quot;CodeBlocks - MinGW Makefiles&quot;</code> to tell <strong>CMake</strong> to generate a build pipeline that uses makefiles.</p>
<p>If you don&rsquo;t have a suitable <strong>make</strong> program installed (<strong>nmake</strong> is <em>not</em> suitable), then one of the simplest ways to get one is to add <strong>MinGW</strong> to your Emscripten SDK.</p>
<p>Run <code>emsdk list</code> to get a list of available packages, and find <code>mingw</code> in the output.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; emsdk list
...
The following precompiled tool packages are available for download:
     *     releases-upstream-048cf9424790cc525a7ea6da340820aae226f3b9-64bit     INSTALLED
     *     releases-upstream-3b8cff670e9233a6623563add831647e8689a86b-64bit     INSTALLED
           releases-fastcomp-048cf9424790cc525a7ea6da340820aae226f3b9-64bit
           releases-fastcomp-3b8cff670e9233a6623563add831647e8689a86b-64bit
           fastcomp-clang-e1.38.30-64bit
           fastcomp-clang-e1.38.31-64bit
           node-4.1.1-64bit
           node-8.9.1-64bit
     *     node-12.9.1-64bit            INSTALLED
           python-2.7.13.1-64bit
           python-3.7.4-64bit
     *     python-3.7.4-pywin32-64bit   INSTALLED
     *     java-8.152-64bit             INSTALLED
           emscripten-1.38.30
           emscripten-1.38.31
           gnu-2.5.4
           mingw-7.1.0-64bit
</code></pre></div><p>Install and activate <code>mingw</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; emsdk install mingw-7.1.0-64bit
C:&gt; emsdk activate mingw-7.1.0-64bit
</code></pre></div><p>This gets you a <code>make</code> program. The <strong>MinGW</strong> version of this is called <code>mingw32-make</code>.</p>
<h2 id="build-your-project">Build your project</h2>
<p>Now you should be able to build your project by running <code>cmake --build</code> followed by the name of the directory that <strong>CMake</strong> created earlier.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:&gt; cmake --build cmake-build-emscripten
</code></pre></div><p>If you opted to use makefiles and got an error saying that it can&rsquo;t find <code>mingw32-make</code>, then re-run <code>emsdk-env.bat</code> to add the <strong>MinGW</strong> binaries to the path and try again.</p>
        </div>
        
        <div>
            <ul id="tags">
                
                <li><a href="/tags/howto">howto</a></li>
                
                <li><a href="/tags/cmake">cmake</a></li>
                
                <li><a href="/tags/emscripten">emscripten</a></li>
                
                <li><a href="/tags/mingw">mingw</a></li>
                
                <li><a href="/tags/ninja">ninja</a></li>
                
            </ul>
        </div>
        
    </article>
</main>
<aside class="wrapper">
    <div>
        <div>
            <h3>Latest Posts</h3>
        </div>
        <div>
            <ul>
                
                <li><a href="/posts/2021/12/28/allocators/">Polymorphic Allocators in C&#43;&#43;</a></li>
                
                <li><a href="/posts/2021/12/19/cpp-modules-2/">Exploring Module Linkage in C&#43;&#43;20</a></li>
                
                <li><a href="/posts/2021/12/12/cpp-modules/">Compiling C&#43;&#43;20 Modules with clang and MSVC</a></li>
                
                <li><a href="/posts/2021/11/28/why_arviss/">Why I wrote Arviss</a></li>
                
                <li><a href="/posts/2021/11/15/how-i-went-to-c/">How I went to C</a></li>
                
            </ul>
        </div>
    </div>
</aside> 
	<footer class="wrapper">
	<p>&copy; 2021 <a href="https://badlydrawnrod.github.io">Badly Drawn Rod</a></p>
</footer>

</body>
</html>
